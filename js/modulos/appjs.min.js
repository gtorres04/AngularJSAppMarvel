"use strict";angular.module("gestion-comics-favoritos",["ngResource","ngRoute","ui.router","ngStorage","ui.bootstrap"]),angular.module("gestion-comics-favoritos").value("Constantes",{URL_SERVICIO_PERSONAJES:"https://gateway.marvel.com:443/v1/public/characters"}).value("Utileria",{getFechaSistema:function(){var e=new Date;return("0"+e.getDate()).slice(-2)+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+e.getFullYear()+"_"+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)},addAutenticacionUrl:function(e,o){e+="?apikey=a3583bee65f9d9b86823aede6a2e3c0c",e+="&ts="+o.replace(" ","");var t=o+"af0cd8a70f0403e3e0537fbe11d4a07fc57c0809a3583bee65f9d9b86823aede6a2e3c0c";return t=CryptoJS.MD5(t),e+="&hash="+t},getNumeroAleatorio:function(e,o){return Math.floor(Math.random()*o+e)},existeComicInArrayOfComics:function(e,o){for(var t=0;t<e.length;t++)if(o.resourceURI==e[t].resourceURI)return!0;return!1},getObjectRandomFromListObjects:function(e){return e[Math.floor(Math.random()*e.length+1)-1]}}),angular.module("gestion-comics-favoritos").service("CharacterModel",["$http","$q","Constantes","Utileria",function(e,o,t,r){this.findByNameStartsWith=function(n){var a=o.defer(),i=a.promise,s=r.getFechaSistema(),c=r.addAutenticacionUrl(t.URL_SERVICIO_PERSONAJES,s);c+="&nameStartsWith="+n;return e.get(c).success(function(e,o,t,r){a.resolve(e.data.results)}).error(function(e,o,t,r){a.reject(e),console.log("status:"+o),console.log("data:"+e)}),i},this.findAll=function(){var n=o.defer(),a=n.promise,i=r.getFechaSistema(),s=r.addAutenticacionUrl(t.URL_SERVICIO_PERSONAJES,i);return e.get(s).success(function(e,o,t,r){n.resolve(e.data.results)}).error(function(e,o,t,r){n.reject(e),console.log("status:"+o),console.log("data:"+e)}),a}}]),angular.module("gestion-comics-favoritos").service("ComicModel",["$http","$q","Utileria",function(e,o,t){this.findByResourceURI=function(r){var n=o.defer(),a=n.promise,i=t.getFechaSistema(),s=t.addAutenticacionUrl(r.resourceURI,i);return e.get(s).success(function(e,o,t,r){n.resolve(e.data.results[0])}).error(function(e,o,t,r){n.reject(e),console.log("status:"+o),console.log("data:"+e)}),a},this.findByCharacter=function(r){var n=o.defer(),a=n.promise,i=t.getFechaSistema(),s=t.addAutenticacionUrl(r.comics.collectionURI,i);return e.get(s).success(function(e,o,t,r){n.resolve(e.data.results)}).error(function(e,o,t,r){n.reject(e),console.log("status:"+o),console.log("data:"+e)}),a}}]),angular.module("gestion-comics-favoritos").service("ComicFavoritoModel",["$http","$q","$localStorage","Utileria",function(e,o,t,r){this.findById=function(e){var o;if(e)for(var r=t.listaFavoritos,n=0;n<r.length;n++)if(e.id===r[n].id){o=r[n];break}return o},this.findAll=function(e){return t.listaFavoritos},this.create=function(e){var o=t.listaFavoritos;return o||(o=new Array),!r.existeComicInArrayOfComics(o,e)&&(o.push(e),t.listaFavoritos=o,!0)},this.delete=function(e){for(var o=t.listaFavoritos,r=0;r<o.length;r++)if(e.id===o[r].id)return o.splice(r,1),t.listaFavoritos=o,!0;return!1}}]),angular.module("gestion-comics-favoritos").service("CharacterService",["$q","CharacterModel",function(e,o){this.findByNameStartsWith=function(t){var r=e.defer(),n=r.promise;return t?o.findByNameStartsWith(t).then(function(e){r.resolve(e)}).catch(function(e){console.log(e)}):o.findAll().then(function(e){r.resolve(e)}).catch(function(e){console.log(e)}),n}}]),angular.module("gestion-comics-favoritos").service("ComicService",["$q","ComicModel",function(e,o){this.findByResourceURI=function(t){var r=e.defer(),n=r.promise;return o.findByResourceURI(t).then(function(e){r.resolve(e)}).catch(function(e){console.log(e)}),n},this.findByCharacter=function(t){var r=e.defer(),n=r.promise;return o.findByCharacter(t).then(function(e){r.resolve(e)}).catch(function(e){console.log(e)}),n}}]),angular.module("gestion-comics-favoritos").service("ComicFavoritoService",["$q","ComicService","ComicFavoritoModel","Utileria",function(e,o,t,r){this.findAll=function(e){return t.findAll()},this.create=function(e){return t.create(e)},this.delete=function(e){return t.delete(e)},this.existsComicInFavourites=function(e){var o=t.findAll();return!!o&&r.existeComicInArrayOfComics(o,e)},this.createComicFavoriteRandomFromListComics=function(t){var n=e.defer(),a=n.promise,i=r.getObjectRandomFromListObjects(t),s=this.create;return o.findByResourceURI(i).then(function(e){n.resolve(s(e))}).catch(function(e){console.log(e),n.reject(e)}),a},this.createThreeComicsFavouritesRandomFromListCharacters=function(t){var n=e.defer(),a=n.promise,i=this.findAll();if(i||(i=new Array),0==i.length){for(var s=new Array;3>s.length;){var c=r.getObjectRandomFromListObjects(t);if(0!=c.comics.items.length){var l=r.getObjectRandomFromListObjects(c.comics.items);r.existeComicInArrayOfComics(s,l)||s.push(l)}}for(var u=this.create,d=0;d<s.length;d++)o.findByResourceURI(s[d]).then(function(e){n.resolve(u(e))}).catch(function(e){console.log(e),n.reject(e)})}return a}}]),angular.module("gestion-comics-favoritos").controller("consultarPersonajesController",["$scope","$state","$rootScope","$stateParams","$uibModal","CharacterService","ComicFavoritoService",function(e,o,t,r,n,a,i){e.listadoPersonajes,e.registrosEncontrados=!1,e.consultarPersonajes=function(){e.filteredTodos=void 0,e.consultandoPersonajes=!0,e.registrosEncontrados=!1,a.findByNameStartsWith(e.patronConsultar).then(function(o){e.consultandoPersonajes=!1,0==o.length?e.registrosEncontrados=!0:(i.createThreeComicsFavouritesRandomFromListCharacters(o).then(function(o){e.comicsFavoritos=i.findAll()}).catch(function(e){console.log(e)}),e.comicsFavoritos=i.findAll(),e.listadoPersonajes=o,e.filteredTodos=[],e.totalItems=e.listadoPersonajes.length,e.currentPage=1,e.numPerPage=10,e.$watch("currentPage + numPerPage",function(){var o=(e.currentPage-1)*e.numPerPage,t=o+e.numPerPage;e.filteredTodos=e.listadoPersonajes.slice(o,t)}))}).catch(function(e){console.log(e)})},e.detallarPersonaje=function(t){o.go("detallePersonaje",{personaje:t,patronBusqueda:e.patronConsultar})},e.verFavoritos=function(){o.go("listaComicsFavoritos")},null!=r.patronBusqueda&&(e.patronConsultar=r.patronBusqueda,e.consultarPersonajes()),e.comicsFavoritos=i.findAll(),e.detallarComic=function(e){o.go("detalleComic",{comic:e,personaje:null})},e.eliminarComicDeFavoritos=function(e){i.delete(e)},e.abrirModalDetalleComic=function(e,o){n.open({templateUrl:"detalle-comic",controller:"detalleComicController",size:e,resolve:{Comic:o}})}}]),angular.module("gestion-comics-favoritos").controller("detallePersonajeController",["$scope","$state","$rootScope","$stateParams","$uibModal","ComicService","ComicFavoritoService",function(e,o,t,r,n,a,i){e.personaje=r.personaje,e.consultandoPersonajes=!0,e.registrosEncontrados=!1,a.findByCharacter(e.personaje).then(function(o){e.consultandoPersonajes=!1,0==o.length?e.registrosEncontrados=!0:e.comics=o}).catch(function(e){console.log(e)});var s=r.patronBusqueda;e.agregarComoFavorito=function(e){i.create(e)||alert("Este comic ya existe en favoritos")},e.isFavorito=function(e){return i.existsComicInFavourites(e)},e.detallarComic=function(t){o.go("detalleComic",{comic:t,personaje:e.personaje})},e.volverListadoPersonajes=function(){o.go("consultarPersonajes",{patronBusqueda:s})},e.comicsFavoritos=i.findAll(),e.eliminarComicDeFavoritos=function(e){i.delete(e)},e.abrirModalDetalleComic=function(e,o){n.open({templateUrl:"detalle-comic",controller:"detalleComicController",size:e,resolve:{Comic:o}})}}]),angular.module("gestion-comics-favoritos").controller("detalleComicController",["$scope","$state","$rootScope","$stateParams","$uibModalInstance","Comic","ComicFavoritoService",function(e,o,t,r,n,a,i){e.comic=a,e.agregarComoFavorito=function(e){i.create(e)||alert("Este comic ya existe en favoritos")},e.isFavorito=function(e){return i.existsComicInFavourites(e)},e.cerrarModal=function(){n.close()}}]),angular.module("gestion-comics-favoritos").config(["$stateProvider","$urlRouterProvider",function(e,o){o.otherwise("/"),e.state("consultarPersonajes",{url:"/",params:{patronBusqueda:null},templateUrl:"consultarPersonajes.html",controller:"consultarPersonajesController as findPersonajes"}).state("detallePersonaje",{url:"/detallePersonaje/",params:{personaje:null,patronBusqueda:null},templateUrl:"detallePersonaje.html",controller:"detallePersonajeController as detailPersonaje"})}]);
